#!/usr/bin/env node

'use strict';

var gitBundles = [
  // JSHint integration.
  // Manually call with :JSHint
  // :JSHintReload reload all .jshintrc option files.
  // :JSHintToggle enable or disable jshint validation
  // Add options to ~/.jshintrc
  'https://github.com/wookiehangover/jshint.vim.git',


  // Adds a file browser to the sidebar
  'https://github.com/scrooloose/nerdtree.git',


  // CSS helpers
  'https://github.com/cakebaker/scss-syntax.vim.git',
  'https://github.com/wavded/vim-stylus.git',


  // JavaScript highlighting and indentation
  'https://github.com/pangloss/vim-javascript.git',


  // Add CoffeeScript support
  'https://github.com/kchmck/vim-coffee-script.git',


  // Add Jade support
  'https://github.com/digitaltoad/vim-jade.git',


  // My color scheme
  'https://github.com/eddiemonge/TigerStripe.git',


  // Line number toggling
  'https://github.com/jeffkreeftmeijer/vim-numbertoggle.git',


  // Change the surrounding elements
  // cs'' to change quotes inside
  // cs'<em> to change quote to a block
  // cst' change a block to quotes
  // ds' or dst to remove surrounding
  // ysiw' surround a word
  // yss' surround line
  // VS<p> adding surround with visual editor
  'https://github.com/tpope/vim-surround.git',
  // Be able to repeat the previous block of plugins
  'https://github.com/tpope/vim-repeat.git',


  // Powerline status bar
  'https://github.com/Lokaltog/powerline.git',


  // Shows the number of matches in a search
  'https://github.com/henrik/vim-indexed-search.git',


  // Quickly open any file
  // See https://github.com/kien/ctrlp.vim for documentation
  'https://github.com/kien/ctrlp.vim.git',


  // Easily jump to location.
  // ,,w for words. ,,f{query} for searches
  'https://github.com/Lokaltog/vim-easymotion.git',


  // ACK for searching
  // :Ack [options] {pattern} [{directory}]
  // go   to preview file (open but maintain focus on ack.vim results)
  // t    to open in new tab
  // T    to open in new tab silently
  // h    to open in horizontal split
  // H    to open in horizontal split silently
  // v    to open in vertical split
  // gv   to open in vertical split silently
  // q    to close the quickfix window
  'https://github.com/mileszs/ack.vim.git',


  // Toggle comments on lines
  // gc(motion) Toggle comments
  'https://github.com/tpope/vim-commentary.git',


  // Allow editorconfig files
  'https://github.com/editorconfig/editorconfig-vim.git',
];

var sys = require('sys');
var exec = require('child_process').exec;
var fs = require('fs');
var path = require('path');
var bundles = path.normalize('.vim/bundle');

var emptyFolderRecursive = function(dir) {
  var files = [];
  if( fs.existsSync(dir) ) {
    files = fs.readdirSync(dir);
    files.forEach(function(file) {
      var curPath = path.normalize(dir + '/' + file);
      if(fs.statSync(curPath).isDirectory()) { // recurse
        emptyFolderRecursive(curPath);
      } else {
        fs.unlinkSync(curPath);
      }
    });
    fs.rmdirSync(dir);
  }
};

console.log('Trashing everything in '+bundles+' (lookout!)');

try {
  emptyFolderRecursive(bundles);
  fs.mkdirSync(bundles);
  process.chdir(bundles);
  console.log('Moving to ' + process.cwd());
}
catch (e) {
  console.log(e);
}

gitBundles.forEach(function(plugin) {
  console.time(plugin);
  exec('git clone '+plugin, function(e,out) {
    console.log('----------------');
    sys.print(out);
    console.timeEnd(plugin);
  });
});